# Maintainer: VitaPlex
# Based on switchfin's mpv build

pkgname=mpv
pkgver=0.36.0
pkgrel=4
pkgdesc="mpv media player library for Vita"
url="https://mpv.io/"
depends=('libass' 'ffmpeg')
source=(
    "https://github.com/mpv-player/mpv/archive/v${pkgver}.tar.gz"
    "gxm.patch"
)
sha256sums=('SKIP' 'SKIP')

prepare() {
    cd mpv-${pkgver}
    patch --strip=1 --input=${srcdir}/gxm.patch
}

build() {
    cd mpv-${pkgver}

    meson setup build --prefix=$prefix --cross-file crossfile.txt \
        --default-library static \
        -Diconv=disabled \
        -Dlua=disabled \
        -Djpeg=disabled \
        -Dopensles=disabled \
        -Dlibavdevice=disabled \
        -Dmanpage-build=disabled \
        -Dhtml-build=disabled \
        -Dsdl2=disabled \
        -Dlibmpv=true \
        -Dgxm=enabled \
        -Dvitashark=disabled \
        -Dcplayer=false

    meson compile -C build
}

package() {
    cd mpv-${pkgver}
    DESTDIR=$pkgdir meson install -C build
}
